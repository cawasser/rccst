<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>bh.rccst.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name"></span> <span class="project-version"></span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bh</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rccst</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></div></li><li class="depth-4 branch"><a href="bh.rccst.api.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-4 branch"><a href="bh.rccst.api.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-4 branch"><a href="bh.rccst.api.login.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>login</span></div></a></li><li class="depth-4 branch"><a href="bh.rccst.api.subscribe.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>subscribe</span></div></a></li><li class="depth-4"><a href="bh.rccst.api.version.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>version</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>components</span></div></div></li><li class="depth-4 branch"><a href="bh.rccst.components.broadcast.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>broadcast</span></div></a></li><li class="depth-4"><a href="bh.rccst.components.database.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>database</span></div></a></li><li class="depth-5 branch"><a href="bh.rccst.components.database.create-and-init.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>create-and-init</span></div></a></li><li class="depth-5"><a href="bh.rccst.components.database.users.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>users</span></div></a></li><li class="depth-4 branch"><a href="bh.rccst.components.pub-sub.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>pub-sub</span></div></a></li><li class="depth-4 branch"><a href="bh.rccst.components.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-4 branch"><a href="bh.rccst.components.system.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>system</span></div></a></li><li class="depth-4 branch"><a href="bh.rccst.components.webserver.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>webserver</span></div></a></li><li class="depth-4"><a href="bh.rccst.components.websocket.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>websocket</span></div></a></li><li class="depth-5 branch"><a href="bh.rccst.components.websocket.handler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>handler</span></div></a></li><li class="depth-5"><a href="bh.rccst.components.websocket.publish.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>publish</span></div></a></li><li class="depth-3 branch current"><a href="bh.rccst.core.html"><div class="inner"><span class="tree" style="top: -362px;"><span class="top" style="height: 371px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data-source</span></div></div></li><li class="depth-4"><a href="bh.rccst.data-source.lookup.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lookup</span></div></a></li><li class="depth-5"><a href="bh.rccst.data-source.lookup.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-3 branch"><a href="bh.rccst.defaults.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>defaults</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>routes</span></div></div></li><li class="depth-4"><a href="bh.rccst.routes.routes.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>routes</span></div></a></li><li class="depth-3"><a href="bh.rccst.version.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>version</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="bh.rccst.core.html#var--main"><div class="inner"><span>-main</span></div></a></li><li class="depth-1"><a href="bh.rccst.core.html#var-last-req"><div class="inner"><span>last-req</span></div></a></li><li class="depth-1"><a href="bh.rccst.core.html#var-new-system"><div class="inner"><span>new-system</span></div></a></li><li class="depth-1"><a href="bh.rccst.core.html#var-rccst-postgres"><div class="inner"><span>rccst-postgres</span></div></a></li><li class="depth-1"><a href="bh.rccst.core.html#var-rccst-sqlite"><div class="inner"><span>rccst-sqlite</span></div></a></li><li class="depth-1"><a href="bh.rccst.core.html#var-start.21"><div class="inner"><span>start!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">bh.rccst.core</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var--main"><h3>-main</h3><div class="usage"><code>(-main &amp; args)</code></div><div class="doc"><div class="markdown"><p>Runs the app.</p>
<ul>
<li>args - a vector of command-line arguments. Currently, ignored.</li>
</ul>
<p>calls (<a href="bh.rccst.core.html#var-start.21">start!</a>) to build the Components and start them running</p>
<blockquote>
<p>See also:</p>
<p><a href="https://github.com/stuartsierra/component">Component</a></p>
</blockquote>
</div></div></div><div class="public anchor" id="var-last-req"><h3>last-req</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>last-req is uses to grab the most recent request made by a client so we can explore at the repl</p>
</div></div></div><div class="public anchor" id="var-new-system"><h3>new-system</h3><div class="usage"><code>(new-system args _)</code></div><div class="doc"><div class="markdown"><p>Constructs a system-map, per Stuart Sierra Component. This brings together all the various ‘stateful’ Components of the system:</p>
<table>
<thead>
<tr><th align="center"> component         </th><th align="left"> description               </th></tr>
</thead>
<tbody>
<tr><td align="center"> Database          </td><td align="left"> durable SQL storage       </td></tr>
<tr><td align="center"> Web Server        </td><td align="left"> handling URL Endpoints    </td></tr>
<tr><td align="center"> Socket Server     </td><td align="left"> data Pub/Sub              </td></tr>
<tr><td align="center"> nRepl             </td><td align="left"> providing a remote Repl for interactive development </td></tr>
<tr><td align="center"> Broadcast         </td><td align="left"> a timer-based publication mechanism (temporary) </td></tr>
<tr><td align="center"> Subscription      </td><td align="left"> mechanism for managing Client subscriptions to data-sources </td></tr>
</tbody>
</table>
<blockquote>
<p>These Components form a Directed Acyclic Graph (DAG) based upon their interdependencies. <img src="../figures/system-component-dag.png" alt="/docs/figures/system-component-dag.png" /></p>
</blockquote>
<ul>
<li>args - (hash-map) configuration items for the various Components, expects the following keys:</li>
</ul>
<table>
<thead>
<tr><th align="left"> keyword       </th><th align="center"> type     </th><th align="left">  description              </th></tr>
</thead>
<tbody>
<tr><td align="left"> :host         </td><td align="center"> string   </td><td align="left"> DNS name for the Web Server, defaults to <code>localhost</code> </td></tr>
<tr><td align="left"> :port         </td><td align="center"> integer  </td><td align="left"> TCP port number for the Web Server, defaults to 8280 </td></tr>
<tr><td align="left"> :nrepl        </td><td align="center"> integer  </td><td align="left"> TCP port for the embedded <a href="https://nrepl.org/nrepl/index.html">nREPL</a>, defaults to 7777 </td></tr>
<tr><td align="left"> :dev-mode     </td><td align="center"> boolean  </td><td align="left"> <code>true</code> or <code>false</code>. If <code>true</code> we start <em>without</em> CSRF anti-forgery. Use this when you want to do development and have the <code>/api-docs/</code> (Swagger-UI) page support <code>POST</code> and <code>PUT</code> endpoint examples. </td></tr>
<tr><td align="left"> :bh.rccst.components.database-spec      </td><td align="center"> hash-map </td><td align="left"> database configuration information. Two are currently provided: </td></tr>
<tr><td align="left" colspan="2"></td><td align="left"> <code>rccst-postgres</code> - configuration for a locally hosted <a href="https://www.postgresql.org">Postgres</a> database. </td></tr>
<tr><td align="left" colspan="2"></td><td align="left"> <code>rccst-sqlite</code>   - configuration for a locally hosted <a href="https://sqlite.org/index.html">SQLite</a> database. </td></tr>
<tr><td align="left"> :socket-params </td><td align="center"> hash-map </td><td align="left"> configuration parameters for the <a href="https://github.com/ptaoussanis/sente">Sente</a>-based websocket. Expected keys are: </td></tr>
<tr><td align="left" colspan="2"></td><td align="left"> <code>:client-fn</code> - function to extract the client-id from the incoming HTTP request </td></tr>
<tr><td align="left" colspan="2"></td><td align="left"> <code>:packer</code>    - function to marshall data into /out-of the socket. We currently are using <a href="https://github.com/cognitect/transit-clj">Transit</a>, hence <code>(sente-transit/get-transit-packer)</code> </td></tr>
<tr><td align="left" colspan="2"></td><td align="left"> <code>:csfr-token-fn</code> - function to return the CSRF, if using CSRF Anti-forgery, <code>nil</code> of not. </td></tr>
<tr><td align="left"> :broadcast-timeout </td><td align="center"> integer </td><td align="left"> number of seconds between ‘publish’ events, defaults to 5 seconds. </td></tr>
</tbody>
</table>
<blockquote>
<p>See also:</p>
<p><a href="https://github.com/stuartsierra/component">Component</a> <a href="https://nrepl.org/nrepl/index.html">nREPL</a> <a href="https://www.postgresql.org">Postgres</a> <a href="https://github.com/ptaoussanis/sente">Sente</a> <a href="https://sqlite.org/index.html">SQLite</a></p>
</blockquote>
</div></div></div><div class="public anchor" id="var-rccst-postgres"><h3>rccst-postgres</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>postgresql database connection spec.</p>
</div></div></div><div class="public anchor" id="var-rccst-sqlite"><h3>rccst-sqlite</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>sqlite database connection spec.</p>
</div></div></div><div class="public anchor" id="var-start.21"><h3>start!</h3><div class="usage"><code>(start! db-type)</code></div><div class="doc"><div class="markdown"><p>Starts the system, defined by (<a href="bh.rccst.core.html#var-new-system">new-system</a>). Presumes a <em>production</em>-type environment, so it will use CSRF tokens.</p>
<blockquote>
<p>Note: the <code>/api-docs/</code> (Swagger-UI) does <strong>NOT</strong> support CSRf on <code>POST</code> or <code>POST</code> endpoints!</p>
<p>If you want to work with the complete API using <code>/api-docs/</code>, you will need to start the server manually at the Repl, so you can access <em>dev-mode</em> (See the Rich Comments).</p>
</blockquote>
<ul>
<li>db-type - which database server to use, we support 2: <a href="https://www.postgresql.org"><em>Postgres</em></a> via <a href="bh.rccst.core.html#var-rccst-postgres">rccst-postgres</a> and <a href="https://sqlite.org/index.html"><em>Sqlite</em></a> via <a href="null">rccts-sqlite</a>.</li>
</ul>
<p>returns: an atom holding the started <code>SystemMap</code> <em>object</em> returned from Component.</p>
<blockquote>
<p>See also:</p>
<p><a href="https://github.com/stuartsierra/component">Component</a></p>
</blockquote>
</div></div></div></div></body></html>